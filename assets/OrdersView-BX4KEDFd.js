import{_ as R,B as O,g as E,u as z,s as M,a as D,b as V,c as W,d as m,e as Z,f as G}from"./card.esm-DqEtZe6c.js";import{C as T,r as H}from"./chart-Co7ClN-s.js";import{d as L,r as f,w as J,o as U,a as K,c,b as l,e as u,h as I,g as v,l as Q,m as _,p as X,t as h,f as Y,u as r,i as n,j as g,k as b,n as A}from"./index-CjBSAxlk.js";import{s as B}from"./calendar.esm-By4zv_NA.js";const ee={class:"chart-container"},ae=L({__name:"LineChart",props:{chartData:{}},setup(s){T.register(...H);const p=s,t=f(null);let i=null;const y=()=>{t.value&&(i&&i.destroy(),i=new T(t.value,{type:"line",data:p.chartData,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}}))};return J(()=>p.chartData,()=>{y()},{deep:!0}),U(y),K(()=>{i&&i.destroy()}),(k,$)=>(u(),c("div",ee,[l("canvas",{ref_key:"chartCanvas",ref:t},null,512)]))}}),te=R(ae,[["__scopeId","data-v-b26f764b"]]);var re=`
@layer primevue {
    .p-tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .p-tag-icon,
    .p-tag-value,
    .p-tag-icon.pi {
        line-height: 1.5;
    }

    .p-tag.p-tag-rounded {
        border-radius: 10rem;
    }
}
`,le={root:function(p){var t=p.props;return["p-tag p-component",{"p-tag-info":t.severity==="info","p-tag-success":t.severity==="success","p-tag-warning":t.severity==="warning","p-tag-danger":t.severity==="danger","p-tag-rounded":t.rounded}]},icon:"p-tag-icon",value:"p-tag-value"},se=O.extend({name:"tag",css:re,classes:le}),oe={name:"BaseTag",extends:E,props:{value:null,severity:null,rounded:Boolean,icon:String},style:se,provide:function(){return{$parentInstance:this}}},N={name:"Tag",extends:oe};function ne(s,p,t,i,y,k){return u(),c("span",_({class:s.cx("root")},s.ptm("root"),{"data-pc-name":"tag"}),[s.$slots.icon?(u(),I(X(s.$slots.icon),_({key:0,class:s.cx("icon")},s.ptm("icon")),null,16,["class"])):s.icon?(u(),c("span",_({key:1,class:[s.cx("icon"),s.icon]},s.ptm("icon")),null,16)):v("",!0),Q(s.$slots,"default",{},function(){return[l("span",_({class:s.cx("value")},s.ptm("value")),h(s.value),17)]})],16)}N.render=ne;const ie={class:"container"},de={key:0,class:"error-message"},ue={class:"filters"},ce={class:"filter-group required"},pe={key:0,class:"required-hint"},ve={class:"filter-group required"},me={key:0,class:"required-hint"},ge={class:"filter-group"},fe={class:"filter-group"},ye={class:"filter-actions"},be={key:1,class:"loading"},he={key:2,class:"chart-container"},ke={key:3,class:"no-data"},Ce={key:5,class:"result-info"},we={key:6,class:"welcome-message"},_e=L({__name:"OrdersView",setup(s){const p=z(),t=f([]),i=f(!1),y=f(1),k=f(10),$=f(0),F=new Date,C=new Date;C.setDate(C.getDate()-7);const a=f({dateFrom:C,dateTo:F,supplierArticle:"",brand:""}),w=async(d=1)=>{if(!a.value.dateFrom||!a.value.dateTo){p.error="Пожалуйста, заполните обязательные поля: Дата от и Дата до";return}i.value=!0;try{const e={dateFrom:a.value.dateFrom,dateTo:a.value.dateTo,page:d,limit:k.value};a.value.supplierArticle&&(e.supplierArticle=a.value.supplierArticle),a.value.brand&&(e.brand=a.value.brand);const o=await p.fetchData("orders",e);t.value=o,$.value=o.length}catch(e){console.error("Error fetching orders:",e)}finally{i.value=!1}},S=()=>{a.value={dateFrom:C,dateTo:F,supplierArticle:"",brand:""},w(1)},q=d=>{y.value=d.page+1,w(y.value)},j=Y(()=>({labels:t.value.slice(0,20).map(d=>d.date?P(d.date):""),datasets:[{label:"Сумма заказов",data:t.value.slice(0,20).map(d=>d.totalPrice||0),backgroundColor:"#FF8C00",borderColor:"#FF6B00",borderWidth:2,fill:!1}]})),x=d=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(d),P=d=>d?new Date(d).toLocaleDateString("ru-RU"):"";return U(()=>w(1)),(d,e)=>(u(),c("div",ie,[e[12]||(e[12]=l("h1",{class:"page-title"},"Заказы",-1)),r(p).error?(u(),c("div",de,[n(r(M),{severity:"error"},{default:g(()=>[b("Ошибка API: "+h(r(p).error),1)]),_:1})])):v("",!0),l("div",ue,[l("div",ce,[e[5]||(e[5]=l("label",null,"Дата от:*",-1)),n(r(B),{modelValue:a.value.dateFrom,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.dateFrom=o),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateFrom}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateFrom?v("",!0):(u(),c("small",pe,"Обязательное поле"))]),l("div",ve,[e[6]||(e[6]=l("label",null,"Дата до:*",-1)),n(r(B),{modelValue:a.value.dateTo,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.dateTo=o),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateTo}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateTo?v("",!0):(u(),c("small",me,"Обязательное поле"))]),l("div",ge,[e[7]||(e[7]=l("label",null,"Артикул:",-1)),n(r(D),{modelValue:a.value.supplierArticle,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.supplierArticle=o),placeholder:"Введите артикул"},null,8,["modelValue"])]),l("div",fe,[e[8]||(e[8]=l("label",null,"Бренд:",-1)),n(r(D),{modelValue:a.value.brand,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.brand=o),placeholder:"Введите бренд"},null,8,["modelValue"])]),l("div",ye,[n(r(V),{label:"Применить фильтры",onClick:e[4]||(e[4]=o=>w(1)),loading:i.value,disabled:!a.value.dateFrom||!a.value.dateTo,class:"orange-button"},null,8,["loading","disabled"]),n(r(V),{label:"Сбросить",onClick:S,severity:"secondary",text:""})])]),i.value?(u(),c("div",be,[n(r(W)),e[9]||(e[9]=l("span",null,"Загрузка данных...",-1))])):v("",!0),!i.value&&t.value.length>0?(u(),c("div",he,[n(te,{"chart-data":j.value},null,8,["chart-data"])])):i.value?v("",!0):(u(),c("div",ke,"Нет данных для отображения графика")),t.value.length>0?(u(),I(r(Z),{key:4,value:t.value,paginator:"",rows:k.value,loading:i.value,totalRecords:$.value,onPage:q,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50,100],currentPageReportTemplate:"Показано {first} - {last} из {totalRecords} записей",class:"orange-table"},{default:g(()=>[n(r(m),{field:"date",header:"Дата",sortable:""},{body:g(({data:o})=>[b(h(P(o.date)),1)]),_:1}),n(r(m),{field:"supplierArticle",header:"Артикул",sortable:""}),n(r(m),{field:"brand",header:"Бренд",sortable:""}),n(r(m),{field:"totalPrice",header:"Сумма",sortable:""},{body:g(({data:o})=>[b(h(x(o.totalPrice)),1)]),_:1}),n(r(m),{field:"warehouseName",header:"Склад",sortable:""}),n(r(m),{field:"isCancel",header:"Отменен",sortable:""},{body:g(({data:o})=>[n(r(N),{value:o.isCancel?"Да":"Нет",severity:o.isCancel?"danger":"success"},null,8,["value","severity"])]),_:1}),n(r(m),{field:"subject",header:"Предмет",sortable:""})]),_:1},8,["value","rows","loading","totalRecords"])):v("",!0),t.value.length>0?(u(),c("div",Ce," Найдено записей: "+h(t.value.length),1)):v("",!0),!t.value.length&&!i.value?(u(),c("div",we,[n(r(G),null,{title:g(()=>e[10]||(e[10]=[b("Добро пожаловать!",-1)])),content:g(()=>e[11]||(e[11]=[l("p",null,"Для просмотра данных о заказах укажите обязательные параметры:",-1),l("ul",null,[l("li",null,[l("strong",null,"Дата от"),b(" - начало периода")]),l("li",null,[l("strong",null,"Дата до"),b(" - конец периода")])],-1)])),_:1})])):v("",!0)]))}}),Ve=R(_e,[["__scopeId","data-v-313fbee3"]]);export{Ve as default};
