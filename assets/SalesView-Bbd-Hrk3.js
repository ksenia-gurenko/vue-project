import{u as x,s as L,a as F,b as T,c as N,d as i,e as U,f as B,_ as I}from"./card.esm-DqEtZe6c.js";import{s as D}from"./calendar.esm-By4zv_NA.js";import{d as S,r as g,o as q,c as d,b as t,g as u,h as E,u as l,i as r,j as c,k as p,t as f,n as A,e as n}from"./index-CjBSAxlk.js";const j={class:"container"},z={key:0,class:"error-message"},M={class:"filters"},O={class:"filter-group required"},G={key:0,class:"required-hint"},H={class:"filter-group required"},J={key:0,class:"required-hint"},K={class:"filter-group"},Q={class:"filter-group"},W={class:"filter-actions"},X={key:1,class:"loading"},Y={key:3,class:"result-info"},Z={key:4,class:"welcome-message"},ee=S({__name:"SalesView",setup(ae){const y=x(),v=g([]),m=g(!1),_=g(1),k=g(10),V=g(0),h=new Date,b=new Date;b.setDate(b.getDate()-7);const a=g({dateFrom:b,dateTo:h,supplierArticle:"",category:""}),P=async(s=1)=>{if(!a.value.dateFrom||!a.value.dateTo){y.error="Пожалуйста, заполните обязательные поля: Дата от и Дата до";return}m.value=!0;try{const e={dateFrom:a.value.dateFrom,dateTo:a.value.dateTo,page:s,limit:k.value};a.value.supplierArticle&&(e.supplierArticle=a.value.supplierArticle),a.value.category&&(e.category=a.value.category);const o=await y.fetchData("sales",e);v.value=o,V.value=o.length}catch(e){console.error("Error fetching sales:",e)}finally{m.value=!1}},R=()=>{a.value={dateFrom:b,dateTo:h,supplierArticle:"",category:""},P(1)},C=s=>{_.value=s.page+1,P(_.value)},w=s=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(s),$=s=>s?new Date(s).toLocaleDateString("ru-RU"):"";return q(()=>P(1)),(s,e)=>(n(),d("div",j,[e[12]||(e[12]=t("h1",{class:"page-title"},"Продажи",-1)),l(y).error?(n(),d("div",z,[r(l(L),{severity:"error"},{default:c(()=>[p("Ошибка API: "+f(l(y).error),1)]),_:1})])):u("",!0),t("div",M,[t("div",O,[e[5]||(e[5]=t("label",null,"Дата от:*",-1)),r(l(D),{modelValue:a.value.dateFrom,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.dateFrom=o),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateFrom}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateFrom?u("",!0):(n(),d("small",G,"Обязательное поле"))]),t("div",H,[e[6]||(e[6]=t("label",null,"Дата до:*",-1)),r(l(D),{modelValue:a.value.dateTo,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.dateTo=o),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateTo}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateTo?u("",!0):(n(),d("small",J,"Обязательное поле"))]),t("div",K,[e[7]||(e[7]=t("label",null,"Артикул:",-1)),r(l(F),{modelValue:a.value.supplierArticle,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.supplierArticle=o),placeholder:"Введите артикул"},null,8,["modelValue"])]),t("div",Q,[e[8]||(e[8]=t("label",null,"Категория:",-1)),r(l(F),{modelValue:a.value.category,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.category=o),placeholder:"Введите категорию"},null,8,["modelValue"])]),t("div",W,[r(l(T),{label:"Применить фильтры",onClick:e[4]||(e[4]=o=>P(1)),loading:m.value,disabled:!a.value.dateFrom||!a.value.dateTo,class:"orange-button"},null,8,["loading","disabled"]),r(l(T),{label:"Сбросить",onClick:R,severity:"secondary",text:""})])]),m.value?(n(),d("div",X,[r(l(N)),e[9]||(e[9]=t("span",null,"Загрузка данных...",-1))])):u("",!0),v.value.length>0?(n(),E(l(U),{key:2,value:v.value,paginator:"",rows:k.value,loading:m.value,totalRecords:V.value,onPage:C,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50,100],currentPageReportTemplate:"Показано {first} - {last} из {totalRecords} записей",class:"orange-table"},{default:c(()=>[r(l(i),{field:"date",header:"Дата",sortable:""},{body:c(({data:o})=>[p(f($(o.date)),1)]),_:1}),r(l(i),{field:"supplierArticle",header:"Артикул",sortable:""}),r(l(i),{field:"brand",header:"Бренд",sortable:""}),r(l(i),{field:"category",header:"Категория",sortable:""}),r(l(i),{field:"totalPrice",header:"Сумма",sortable:""},{body:c(({data:o})=>[p(f(w(o.totalPrice)),1)]),_:1}),r(l(i),{field:"forPay",header:"К оплате",sortable:""},{body:c(({data:o})=>[p(f(w(o.forPay)),1)]),_:1}),r(l(i),{field:"warehouseName",header:"Склад",sortable:""})]),_:1},8,["value","rows","loading","totalRecords"])):u("",!0),v.value.length>0?(n(),d("div",Y," Найдено записей: "+f(v.value.length),1)):u("",!0),!v.value.length&&!m.value?(n(),d("div",Z,[r(l(B),null,{title:c(()=>e[10]||(e[10]=[p("Добро пожаловать!",-1)])),content:c(()=>e[11]||(e[11]=[t("p",null,"Для просмотра данных о продажах укажите обязательные параметры:",-1),t("ul",null,[t("li",null,[t("strong",null,"Дата от"),p(" - начало периода")]),t("li",null,[t("strong",null,"Дата до"),p(" - конец периода")])],-1)])),_:1})])):u("",!0)]))}}),re=I(ee,[["__scopeId","data-v-78c4959f"]]);export{re as default};
