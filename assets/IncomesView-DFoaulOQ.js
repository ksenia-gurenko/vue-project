import{_ as $,u as S,s as z,a as V,b as N,c as j,d as f,e as E,f as M}from"./card.esm-DqEtZe6c.js";import{C as T,r as O}from"./chart-Co7ClN-s.js";import{d as B,r as p,w as W,o as x,a as Z,c as d,b as t,e as u,f as G,g as c,h as H,u as l,i as s,j as g,k as h,t as _,n as A}from"./index-CjBSAxlk.js";import{s as R}from"./calendar.esm-By4zv_NA.js";const J={class:"chart-container"},K=B({__name:"BarChart",props:{chartData:{}},setup(F){T.register(...O);const v=F,i=p(null);let o=null;const b=()=>{i.value&&(o&&o.destroy(),o=new T(i.value,{type:"bar",data:v.chartData,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}}))};return W(()=>v.chartData,()=>{b()},{deep:!0}),x(b),Z(()=>{o&&o.destroy()}),(C,w)=>(u(),d("div",J,[t("canvas",{ref_key:"chartCanvas",ref:i},null,512)]))}}),Q=$(K,[["__scopeId","data-v-bb4b6028"]]),X={class:"container"},Y={key:0,class:"error-message"},ee={class:"filters"},ae={class:"filter-group required"},te={key:0,class:"required-hint"},le={class:"filter-group required"},se={key:0,class:"required-hint"},re={class:"filter-group"},oe={class:"filter-group"},ne={class:"filter-actions"},ue={key:1,class:"loading"},ie={key:2,class:"chart-container"},de={key:3,class:"no-data"},ce={key:5,class:"result-info"},pe={key:6,class:"welcome-message"},ve=B({__name:"IncomesView",setup(F){const v=S(),i=p([]),o=p(!1),b=p(1),C=p(10),w=p(0),m=p(!1),D=new Date,y=new Date;y.setDate(y.getDate()-7);const a=p({dateFrom:y,dateTo:D,supplierArticle:"",warehouseName:""}),k=async(n=1)=>{if(!a.value.dateFrom||!a.value.dateTo){v.error="Пожалуйста, заполните обязательные поля: Дата от и Дата до";return}o.value=!0;try{const e={dateFrom:a.value.dateFrom,dateTo:a.value.dateTo};a.value.supplierArticle&&(e.supplierArticle=a.value.supplierArticle),a.value.warehouseName&&(e.warehouseName=a.value.warehouseName);const r=await v.fetchData("incomes",e);i.value=r,w.value=r.length,m.value=!0}catch(e){console.error("Ошибка загрузки поступлений:",e),m.value=!1}finally{o.value=!1}},I=()=>{a.value={dateFrom:y,dateTo:D,supplierArticle:"",warehouseName:""},m.value=!1},U=n=>{b.value=n.page+1,k(b.value)},L=G(()=>({labels:i.value.slice(0,20).map(n=>n.date?P(n.date):""),datasets:[{label:"Количество поступлений",data:i.value.slice(0,20).map(n=>n.quantity||0),backgroundColor:"#FF8C00",borderColor:"#FF6B00",borderWidth:2}]})),q=n=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(n),P=n=>n?new Date(n).toLocaleDateString("ru-RU"):"";return x(()=>{k(1)}),(n,e)=>(u(),d("div",X,[e[12]||(e[12]=t("h1",{class:"page-title"},"Поступления",-1)),l(v).error?(u(),d("div",Y,[s(l(z),{severity:"error"},{default:g(()=>[h("Ошибка API: "+_(l(v).error),1)]),_:1})])):c("",!0),t("div",ee,[t("div",ae,[e[5]||(e[5]=t("label",null,"Дата от:*",-1)),s(l(R),{modelValue:a.value.dateFrom,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.dateFrom=r),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateFrom}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateFrom?c("",!0):(u(),d("small",te,"Обязательное поле"))]),t("div",le,[e[6]||(e[6]=t("label",null,"Дата до:*",-1)),s(l(R),{modelValue:a.value.dateTo,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.dateTo=r),dateFormat:"yy-mm-dd",showIcon:"",class:A({"p-invalid":!a.value.dateTo}),placeholder:"Выберите дату"},null,8,["modelValue","class"]),a.value.dateTo?c("",!0):(u(),d("small",se,"Обязательное поле"))]),t("div",re,[e[7]||(e[7]=t("label",null,"Артикул поставщика:",-1)),s(l(V),{modelValue:a.value.supplierArticle,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.supplierArticle=r),placeholder:"Введите артикул"},null,8,["modelValue"])]),t("div",oe,[e[8]||(e[8]=t("label",null,"Склад:",-1)),s(l(V),{modelValue:a.value.warehouseName,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.warehouseName=r),placeholder:"Введите склад"},null,8,["modelValue"])]),t("div",ne,[s(l(N),{label:"Применить фильтры",onClick:e[4]||(e[4]=r=>k(1)),loading:o.value,disabled:!a.value.dateFrom||!a.value.dateTo,class:"orange-button"},null,8,["loading","disabled"]),s(l(N),{label:"Сбросить",onClick:I,severity:"secondary",text:""})])]),o.value?(u(),d("div",ue,[s(l(j)),e[9]||(e[9]=t("span",null,"Загрузка данных...",-1))])):c("",!0),!o.value&&i.value.length>0?(u(),d("div",ie,[s(Q,{"chart-data":L.value},null,8,["chart-data"])])):!o.value&&m.value?(u(),d("div",de," Нет данных для отображения графика ")):c("",!0),m.value?(u(),H(l(E),{key:4,value:i.value,paginator:"",rows:C.value,loading:o.value,totalRecords:w.value,onPage:U,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50,100],currentPageReportTemplate:"Показано {first} - {last} из {totalRecords} записей",class:"orange-table"},{default:g(()=>[s(l(f),{field:"date",header:"Дата",sortable:""},{body:g(({data:r})=>[h(_(P(r.date)),1)]),_:1}),s(l(f),{field:"supplierArticle",header:"Артикул",sortable:""}),s(l(f),{field:"techSize",header:"Размер",sortable:""}),s(l(f),{field:"quantity",header:"Количество",sortable:""}),s(l(f),{field:"totalPrice",header:"Сумма",sortable:""},{body:g(({data:r})=>[h(_(q(r.totalPrice)),1)]),_:1}),s(l(f),{field:"warehouseName",header:"Склад",sortable:""}),s(l(f),{field:"status",header:"Статус",sortable:""})]),_:1},8,["value","rows","loading","totalRecords"])):c("",!0),m.value?(u(),d("div",ce," Найдено записей: "+_(i.value.length),1)):c("",!0),!m.value&&!o.value?(u(),d("div",pe,[s(l(M),null,{title:g(()=>e[10]||(e[10]=[h("Добро пожаловать!",-1)])),content:g(()=>e[11]||(e[11]=[t("p",null,"Для просмотра данных о поступлениях укажите обязательные параметры:",-1),t("ul",null,[t("li",null,[t("strong",null,"Дата от"),h(" - начало периода")]),t("li",null,[t("strong",null,"Дата до"),h(" - конец периода")])],-1),t("p",null,'После заполнения этих полей нажмите "Применить фильтры".',-1)])),_:1})])):c("",!0)]))}}),be=$(ve,[["__scopeId","data-v-78733ce0"]]);export{be as default};
